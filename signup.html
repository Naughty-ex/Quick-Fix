<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/login-form-06/fonts/icomoon/style.css">
    <link rel="icon" type="image/x-icon" href="/logo.png">
    <link rel="stylesheet" href="/login-form-06/css/owl.carousel.min.css">
    <link rel="stylesheet" href="/login-form-06/css/bootstrap.min.css">
    <link rel="stylesheet" href="/login-form-06/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <title>QuicK-Fix</title>
</head>
<body>

<div class="d-lg-flex half">
  <div class="bg order-1 order-md-2" style="background-image: url('https://images.unsplash.com/photo-1611396000732-f8c9a933424f?fm=jpg&w=3000&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTB8fGNlbGwlMjBwaG9uZSUyMHJlcGFpcnxlbnwwfHwwfHx8MA%3D%3D');"></div>
  <div class="contents order-2 order-md-1">

    <div class="container">
      <div class="row align-items-center justify-content-center">
        <div class="col-md-7">
          <div class="mb-4">
            <h4>Sign Up</h4>
           <!-- <p class="mb-4">Create your account to get started.</p> -->
          </div>
          <form action="" id="myForm">
            <!-- Success Modal -->
            <div id="successModal" class="modal" style="display:none;">
              <div class="modal-content">
                <div class="modal-header">
                  Quick-Fix
                </div>
                <span class="close">&times;</span>
                <p>Account created successfully!</p>
              </div>
            </div>
            
            
            <div class="inputWrap">
                Full Name
            <div class="form-group first">
              <input type="text" class="form-control" name="" id="fullName" placeholder="e.g Muhammad Ibrahim" required>
            </div>
            Email
            <div class="form-group">
              <input type="email" class="form-control" id="email" placeholder="email@domain.com" >
            </div>
            Phone Number
            <div class="form-group">
              <input type="tel" class="form-control" id="contact" placeholder="098754345" >
            </div>
            Password
            <div class="form-group last mb-3">
              <input type="password" class="form-control" id="password" required>
              <span class="togglePassword"><i class="fas fa-eye"></i></span>
          </div>
          <!-- <div id="passwordRequirement" class="mt-2">Password must be at least 6 characters long.</div> -->
          <div id="passwordStrength" class="mt-2"></div>
          <br>
          confirm Password
          <div class="form-group last mb-3">
              <input type="password" class="form-control" id="confirmPassword" required>
              <span class="toggleConfirmPassword"><i class="fas fa-eye"></i></span>
          </div>
          <div id="passwordMatch" class="mt-2"></div>
          <br>
          
            <input type="submit" value="Sign Up" class="nextWrap btn btn-block btn-primary">
            
        
        
  
              <br>
              <p>Already have an account? <a href="signin.html" class="signin">Sign in here.</a></p>
            </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- <script src="./login-form-06/js/jquery-3.3.1.min.js"></script> -->
<!-- <script src="./login-form-06/js/popper.min.js"></script> -->
<!-- <script src="./login-form-06/js/bootstrap.min.js"></script> -->
  <!-- <script src="js/main.js"></script> -->

  <script>
// Define all necessary functions first

function toggleVisibility(fieldId, toggleIcon) {
    const field = document.getElementById(fieldId);
    const type = field.getAttribute('type') === 'password' ? 'text' : 'password';
    field.setAttribute('type', type);
    toggleIcon.firstChild.classList.toggle('fa-eye');
    toggleIcon.firstChild.classList.toggle('fa-eye-slash');
}

function setupPasswordToggle() {
    const togglePassword = document.querySelector('.togglePassword');
    const toggleConfirmPassword = document.querySelector('.toggleConfirmPassword');

    togglePassword.addEventListener('click', function() {
        toggleVisibility('password', this);
    });

    toggleConfirmPassword.addEventListener('click', function() {
        toggleVisibility('confirmPassword', this);
    });
}

function setupFormValidation() {
    // Your form validation logic here
}

function calculatePasswordStrength(password) {
    let strength = { message: '', class: '' };
    if (password.length >= 6 && /[a-z]/.test(password) && /[A-Z]/.test(password) && /[0-9]/.test(password)) {
        strength.message = 'Strong Password!';
        strength.class = 'strong';
    } else if (/[a-z]/.test(password) && /[A-Z]/.test(password)) {
        strength.message = 'Fair Password!';
        strength.class = 'fair';
    } else {
        strength.message = 'Weak Password!';
        strength.class = 'weak';
    }
    return strength;
}

function setupFormSubmission() {
    const form = document.getElementById('myForm');
    form.addEventListener('submit', function(event) {
        event.preventDefault();
        console.log("Form submission prevented.");

        // Example of simple form validation
        const fullName = document.getElementById('fullName').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (!fullName || !email || !password || password !== confirmPassword) {
            console.log("Form validation failed.");
            // Here, you can update the UI to inform the user of the validation failure
            return; // Stop the function if validation fails
        }

        // If validation passes, prepare the data to be sent
        const formData = {
            fullName: fullName,
            email: email,
            password: password,
            confirmPassword: confirmPassword,
            // Include other form fields as necessary
        };

        // Use Fetch API to submit form data asynchronously
        fetch('https://quickfix-sy96.onrender.com/api/auth/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
        })
        // after submit 
       .then(response => response.json())
.then(data => {
    console.log('Success:', data);
    // Display the success modal
    const modal = document.getElementById('successModal');
    const span = document.getElementsByClassName('close')[0];

    modal.style.display = "block";

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
        window.location.href = 'signin.html'; // Redirect after closing the modal
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
            window.location.href = 'signin.html'; // Redirect after closing the modal
        }
    }
})
        .catch((error) => {
            console.error('Error:', error);
            // Handle errors, e.g., displaying an error message to the user
        });
    });
}



// Execute setup functions after the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    setupPasswordToggle();
    setupFormSubmission();
});

function setupFormValidation() {
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirmPassword');
    const passwordStrength = document.getElementById('passwordStrength');
    const passwordRequirement = document.getElementById('passwordRequirement');
    const passwordMatch = document.getElementById('passwordMatch');
    let timeout;

    password.addEventListener('input', function() {
        clearTimeout(timeout);
        const strength = calculatePasswordStrength(password.value);
        passwordStrength.innerHTML = strength.message;
        passwordStrength.className = 'strength ' + strength.class;
        timeout = setTimeout(() => clearMessage(passwordStrength), 3000);

        if(password.value.length >= 6) {
            passwordRequirement.style.display = 'none';
        } else {
            passwordRequirement.style.display = 'block';
            passwordRequirement.textContent = 'Password must be at least 6 characters long.';
        }
    });

    confirmPassword.addEventListener('input', function() {
        passwordMatch.textContent = password.value !== confirmPassword.value ? "Passwords do not match!" : "";
        passwordMatch.className = password.value !== confirmPassword.value ? 'validation' : '';
    });
}

function calculatePasswordStrength(password) {
    let strength = { message: '', class: '' };
    if (password.length >= 6 && /[a-z]/.test(password) && /[A-Z]/.test(password) && /[0-9]/.test(password)) {
        strength.message = 'Strong Password!';
        strength.class = 'strong';
    } else if (/[a-z]/.test(password) && /[A-Z]/.test(password)) {
        strength.message = 'Fair Password!';
        strength.class = 'fair';
    } else {
        strength.message = 'Weak Password!';
        strength.class = 'weak';
    }
    return strength;
}
// const form = document.getElementById('myForm');
// const inputWrap = document.querySelector(".inputWrap");
const fullName = document.getElementById('fullName');
const contact = document.getElementById('contact');
const email = document.getElementById('email');
const password = document.getElementById('password');
const confirmPassword = document.getElementById('confirmPassword');
// const container = document.querySelector(".container");
// const togglePassword = document.querySelector(".togglepwd");
// const toggleConfirmPassword = document.querySelector(".togglepwd2")
// toggle password
togglePassword.addEventListener("click",()=>{
   if(password.type === "password"){
      password.type = "text"
   }else{
      password.type = "password";
   }
})
toggleConfirmPassword.addEventListener("click",()=>{
   if(confirmPassword.type === "password"){
      confirmPassword.type = "text"
   }else{
      confirmPassword.type = "password";
   }
})

// validation messages
let errorMessage= document.createElement("p");
let errorMessageEmail = document.createElement("p");
let errorMessageContact = document.createElement("p");
let errorMessagePwd = document.createElement("p");
// succcess message
let successMessage = document.createElement("div")
   // successMessage.innerHTML = "Form submitted successfully!!"
   successMessage.style.cssText = "z-index:1000 ; padding:10px; background:white; height:7vh; align-self:center; font-size:1.2rem; display:grid; place-items:center;border:1px solid green "
//  Error Message  
let errorPwdMessage = document.createElement("div")
   errorPwdMessage.innerHTML = "Passwords do not match!"
   errorPwdMessage.style.cssText = "z-index:1000 ; padding:10px; background:white; height:7vh; align-self:center; font-size:1.2rem; display:grid; place-items:center;border:1px solid green "
// error message
let errormsg = document.createElement("div");
errormsg.style.cssText = "z-index:1000 ; padding:10px; background:white; height:7vh; align-self:center; font-size:1.2rem; display:grid; place-items:center;border:1px solid red "


// email validation

console.log("hi")

email.addEventListener("blur" , ()=>{

    const emailRegex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    if (!emailRegex.test(email.value)) {
       errorMessageEmail.textContent = " Please enter a valid email address."
       inputWrap.insertBefore(errorMessageEmail , email.nextElementSibling) ;
       let emalVal = email.value;
       email.value = null;
        
    }else{
        errorMessageEmail.remove();
    }
})

// Password length validation
password.addEventListener("keyup" , ()=>{
   if (password.value.length < 6) {
       errorMessagePwd.textContent = " Password must be at least 6 characters long."
       inputWrap.insertBefore(errorMessagePwd , password.nextElementSibling)
  
      //  isValid = false;
   }else{
       errorMessagePwd.remove();
   }

})




 // Validation checks
 let isValid = true;

 // Full name validation 
 if (fullName.value.trim() === '' ) {
   
     errorMessage.textContent = "Please enter your full name."
       inputWrap.insertBefore(errorMessage , fullName.nextElementSibling)
   
     isValid = false;
 }else{
     errorMessage.remove();
 }
  

//  Email validation (check for @ and .)
 const emailRegex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
 if (!emailRegex.test(email.value)) {
    event.preventDefault(); 
   //  let emalVal = email.value;
   //  email.value = null;
     
    isValid = false;  
    
 }

 //  Password validation (example: check for minimum length)
 if (password.value.length < 8) {
   isValid = false;
}


 

//  Passwords match check
 if (confirmPassword.value !== password.value) {
   
     isValid = false;
     
     password.value = null;
     confirmPassword.value = null;
     container.insertBefore(errorPwdMessage , form)  
     setTimeout(()=>{
         errorPwdMessage.remove();
        },3000)                           ;
 }

 if (isValid) {
   


  class UserInfo {
    constructor(name, email, phoneNumber, password, confirmPassword) {
      this.name = name;
      this.email = email;
      this.phoneNumber = phoneNumber;
      this.password = password;
      this.confirmPassword = confirmPassword;
    }
  }
    
   let fullNameValue = fullName.value;
   let emailvalue = email.value;
   let contactValue = contact.value;
   let passwordValue = password.value;
   let passwordConfirmValue = confirmPassword.value;
   let user = new UserInfo(
     fullNameValue,
     emailvalue,
     contactValue,
     passwordValue,
     passwordConfirmValue
   );
    
     fetch("https://quickfix-sy96.onrender.com/api/auth/register", {
       method: "POST",
       headers: {
         "content-Type": "application/json",
       },
       body: JSON.stringify(user),
     })
       .then((response) => {
         if (response.ok) {
           console.log(response);
           successMessage.innerHTML = "Redirecting...";
           container.insertBefore(successMessage, form);
           setTimeout(() => {
             successMessage.remove();
             setTimeout(() => {
               console.log("Logged In");;
             }, 1000);
           }, 5000);
           return response.json()
         } else {
           errormsg.innerHTML = "check your email!";
           container.insertBefore(errormsg, form);
           setTimeout(() => {
             errormsg.remove();
           }, 3000);
         }
       }).then((data)=>{
        console.log(data);
       })
       .catch((error) => {
         errormsg.innerHTML = "Check your data Connection!";
         container.insertBefore(errormsg, form);
         setTimeout(() => {
           errormsg.remove();
         }, 6000);
         console.log("Error during signUp");
       });

     
     console.log(user)


 }
 


  </script>
  </body>
  </html>
